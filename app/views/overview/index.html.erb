<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.5.3/js/bootstrapValidator.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw==" crossorigin="anonymous" />
<div class="container-fluid" id="main">

    <div class="row row-offcanvas row-offcanvas-left">
        <div class="col main pt-5 mt-3 text-center ">
            <h1 class="display-4 d-none d-sm-block">
            Overview
            </h1>

            <div class="alert alert-warning fade collapse" role="alert" id="myAlert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                    <span class="sr-only">Close</span>
                </button>
                <strong>Holy guacamole!</strong> It's free.. this is an example theme.
            </div>
            <div class="row ">
            	<div class="col-md-12 align-items-center justify-content-center d-flex">
								<form id="form" name="form" class="form-inline">
								    <div class="form-group">
								        <label for="startDate">Start Date</label>
								        <input id="startDate" name="startDate" type="text" class="form-control" />
								        &nbsp;
								        <label for="endDate">End Date</label>
								        <input id="endDate" name="endDate" type="text" class="form-control" />
								        <%= radio_button_tag(:payment, 'Cash', @payment=='Cash', class: 'ml-3') %>
								      	<label for="payment_cash"  class="ml-2">Cash</label>
							      	  <%= radio_button_tag(:payment, 'Invoice Cash', @payment=='Invoice Cash', class: 'ml-3') %>

								      	<label for="payment_invoice_cash" class="ml-2">Invoice Cash</label>
								        <%= radio_button_tag(:payment, 'Invoice Card', @payment=='Invoice Card', class: 'ml-3') %>
								      	<label for="payment_invoice_card"  class="ml-2">Invoice Card</label>

								        <input type="submit" class="btn btn-primary" value="Submit">
								    </div>

								</form>
							</div>
            </div>	
            <div class="row mb-3">
                <div class="col-xl-3 col-sm-6 py-2">
                    <div class="card bg-success text-white h-100">
                        <div class="card-body bg-success">
                            <div class="rotate">
                                <i class="fa fa-user fa-4x"></i>
                            </div>
                            <h6 class="text-uppercase">Total Orders</h6>
                            <h1 class="display-4"><%= @orders.count%></h1>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 py-2">
                    <div class="card text-white bg-danger h-100">
                        <div class="card-body bg-danger">
                            <div class="rotate">
                                <i class="fa fa-list fa-4x"></i>
                            </div>
                            <h6 class="text-uppercase">Total Quantity</h6>
                            <h1 class="display-4"><%= @orders.pluck(:order_qty).inject(0){|sum,x| sum + x } %></h1>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 py-2">
                    <div class="card text-white bg-info h-100">
                        <div class="card-body bg-info">
                            <div class="rotate">
                                <i class="fa fa-twitter fa-4x"></i>
                            </div>
                            <h6 class="text-uppercase">Total Payment</h6>
                            <h1 class="display-4"><%= @orders.pluck(:total).inject(0){|sum,x| sum + x } %></h1>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 py-2">
                    <div class="card text-white bg-warning h-100">
                        <div class="card-body">
                            <div class="rotate">
                                <i class="fa fa-share fa-4x"></i>
                            </div>
                            <h6 class="text-uppercase">Selling Products Count</h6>
                            <h1 class="display-4"><%= @orders.pluck(:product_id).uniq.count %></h1>
                        </div>
                    </div>
                </div>
            </div>

		        <table class="table table-striped">
					    <thead>
					      <tr>
					        <th>Order Id</th>
					        <th>Order Name</th>
					        <th>Order qty</th>
					        <th>Order Total</th>
					        <th>Payment</th>
					        <th>Status</th>
					        <th>Created at</th>
					        <th colspan="3"></th>
					      </tr>
					    </thead>

					    <tbody>
					      <%# count = 0 %>
					      <%# date = "" %>
					      <% @orders.each_with_index do |order, val| %>
					        <% count = val + 1 %>
					          <%if order.reserve_status == false && order.paidtype == "Cash" %>
					          <tr>
					            <td><%= count -=  1 %></td>
					            <td><%= order.label %></td>
					            <td><%= order.order_qty %></td>
					            <td><%= order.total %></td>
					            <%if order.paidtype.present?%>
					              <td><%= order.paidtype %></td>
					            <%else%>
					              <td></td>
					            <%end%>
					            <td><%= order.status %></td>
					            <td><%= order.created_at.strftime('%d/%m/%Y, %I:%M:%S:%p') %></td>
					             <%# <td><%= link_to 'Edit', edit_order_path(order)</td> %>
					              <td>
					                <%= link_to 'Detail', order_path(order, order_id: count) %>
					              </td>
					              <td>
					                <%= link_to 'download', "/file/#{order.id}" if has_file? order.id %>
					              </td>
					              <% if current_user.role == "admin" %>
					                <td>
					                  <%= link_to 'Delete', order, method: :delete, data: { confirm: 'Are you sure?' } %>
					                </td>
					              <% end %>
					                <% if order.status === 'Processed' %>
					                  <td>
					                    <%= link_to 'Cancel', cancel_order_path(id: order.id), data: { confirm: 'Are you sure?' } %>
					                  </td>
					                <% end %>
					              </td>
					          </tr>
					        <% end %>
					      <% end %>
					    </tbody>
					  </table>
            <!--/row-->
        </div>
    </div>
</div>
<script type="text/javascript">
	var bindDateRangeValidation = function (f, s, e) {
    if(!(f instanceof jQuery)){
			console.log("Not passing a jQuery object");
    }
  
    var jqForm = f,
        startDateId = s,
        endDateId = e;
  
    var checkDateRange = function (startDate, endDate) {
        var isValid = (startDate != "" && endDate != "") ? startDate <= endDate : true;
        return isValid;
    }

    var hookValidatorEvt = function () {
        var dateBlur = function (e, bundleDateId, action) {
            jqForm.bootstrapValidator('revalidateField', e.target.id);
        }

        $('#' + startDateId).on("dp.change dp.update blur", function (e) {
            $('#' + endDateId).datepicker({ maxDate: e.date });
            dateBlur(e, endDateId);
        });

        $('#' + endDateId).on("dp.change dp.update blur", function (e) {
            $('#' + startDateId).datepicker({ maxDate: e.date });
            dateBlur(e, startDateId);
        });
    }

    hookValidatorEvt();
};


$(function () {
	<% if @start_date and @end_date %>
    	var sd = new Date("<%= @start_date.strftime('%m/%d/%Y')%>"), ed = new Date("<%= @end_date.strftime('%m/%d/%Y')%>");
    	$("#startDate").datepicker("setDate", sd)
	    $("#endDate").datepicker("setDate", ed)
	<% else %>	
    	var sd = new Date(), ed = new Date();
  	<% end %>

    $('#startDate').datepicker({ 
      pickTime: false,
    });
    $('#endDate').datepicker({ 
      pickTime: false
    });

    //passing 1.jquery form object, 2.start date dom Id, 3.end date dom Id
    bindDateRangeValidation($("#form"), 'startDate', 'endDate');
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/js/bootstrap-datetimepicker.min.js">